<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>Form</title>
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <link rel="stylesheet" href="css/form.css?v=4" />
</head>
<body>
  <div class="wrap">
    <h1 id="title">Girlfriend Support Form</h1>

    <!-- FORM -->
    <form id="contact-form" class="form">
      <label class="label" for="category">What is it about?</label>
      <select id="category" name="category" required class="field">
        <option value="" disabled selected>Select one...</option>
        <option>Order</option>
        <option>Request</option>
        <option>Proposal</option>
        <option>Complaint</option>
      </select>

      <label class="label" for="message">Message</label>
      <textarea id="message" name="message" required rows="6" class="field" placeholder="Write your message here..."></textarea>

      <button type="submit" class="btn" id="submit-btn">Send</button>

      <p id="status" class="status" role="status" aria-live="polite"></p>
    </form>

    <a class="btn btn-secondary" href="letterbox.html">Back to letterbox</a>
  </div>

  <script src="./assets/auth.js"></script>
  <script>
    //require login to view this page
    (async () => {
      try { await requireSessionOrRedirect(); } catch {}
    })();
  </script>

  <!-- EmailJS Browser SDK -->
  <script src="https://cdn.jsdelivr.net/npm/@emailjs/browser@4/dist/email.min.js"></script>
  <script>

    const EMAILJS_PUBLIC_KEY = "m3YHrKcQhhYx9OD5H";
    const EMAILJS_SERVICE_ID = "service_hrt3iun";
    const EMAILJS_TEMPLATE_ID = "template_ap2kr7v";


    // Init EmailJS
    emailjs.init({ publicKey: EMAILJS_PUBLIC_KEY });

    // Submit handler
    const form = document.getElementById('contact-form');
    const statusEl = document.getElementById('status');
    const submitBtn = document.getElementById('submit-btn');

    form.addEventListener('submit', async (e) => {
      e.preventDefault();
      statusEl.textContent = "";
      submitBtn.disabled = true;
      submitBtn.textContent = "Sendingâ€¦";

      try {
        // Option A: sendForm reads the form fields by name
        await emailjs.sendForm(EMAILJS_SERVICE_ID, EMAILJS_TEMPLATE_ID, form);

        statusEl.textContent = "Thanks! Your message was sent.";
        form.reset();
      } catch (err) {
        console.error(err);
        statusEl.textContent = "Sorry, something went wrong. Please try again.";
      } finally {
        submitBtn.disabled = false;
        submitBtn.textContent = "Send";
      }
    });
  </script>
</body>
</html>